<div class="container">
  <h2 class="section-title">Dashboard</h2>

  <!-- Loader -->
  <div *ngIf="isLoading" class="loader-overlay">
    <div class="loader"></div>
  </div>

  <!-- Success & Error Messages -->
  <div *ngIf="successMessage" class="alert success-alert">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert error-alert">{{ errorMessage }}</div>

  <!-- Document List -->
  <div class="card">
    <h3 class="card-title"><span class="global-icon"></span> My Documents</h3>
    <div *ngIf="documents.length > 0; else noDocuments" class="table-container">
      <table class="document-table">
        <thead>
          <tr>
            <!-- <th>ID</th> -->
            <th>Name</th>
            <th>Extension</th>
            <th>Uploaded At</th>
            <!-- <th>Vector ID</th> -->
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let doc of documents">
            <!-- <td>{{ doc.id }}</td> -->
            <td>{{ doc.title }}</td>
            <!-- <td>
              <span class="file-icon" [ngClass]="{
                'pdf-icon': doc.extension === 'pdf',
                'txt-icon': doc.extension === 'txt'
              }"></span>
              {{ doc.title }}
            </td> -->
            <td>
              <!-- <i [ngClass]="getFileIconClass(doc.extension)" class="file-icon"></i> -->
              {{ doc.extension.toUpperCase() }}
            </td>
            <td>{{ doc.uploaded_at }}</td>
            <!-- <td>{{ doc.vector_id }}</td> -->
            <td>
              <button (click)="openChatbot(doc)" class="chat-icon" title="Chat about this document"></button>
              <button (click)="deleteDocument(doc)" class="delete-icon" title="Delete document"></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #noDocuments>
      <p class="no-documents">No documents found. Please upload a document.</p>
    </ng-template>
    <div class="action-buttons">
      <input
        type="file"
        (change)="onFileSelected($event)"
        class="file-input"
        id="file-upload"
      >
      <label for="file-upload" class="upload-btn">Upload Document</label>
    </div>
  </div>

  <!-- Chatbot Modal
  <div *ngIf="showChatbot" class="modal">
    <div class="modal-content">
      <div class="chat-header">
        <h3>Document Assistant: {{ selectedDocumentTitle || 'General Chat' }}</h3>
        <button (click)="closeChatbot()" class="close-btn">Close</button>
      </div>
      <div class="chat-window">
        <div *ngFor="let message of chatMessages" class="message" [ngClass]="{
          'user-message': message.type === 'user',
          'system-message': message.type === 'system',
          'error-message': message.type === 'error',
          'success-message': message.type === 'success'
        }">
          <div class="message-content">{{ message.content }}</div>
          <div class="message-timestamp">{{ message.timestamp }}</div>
        </div>
      </div>
      <div class="chat-input">
        <textarea
          [(ngModel)]="chatInput"
          (keypress)="onKeyPress($event)"
          placeholder="Ask a question..."
          class="text-input"
        ></textarea>
        <button (click)="handleChatInput()" class="send-btn">Send</button>
      </div>
    </div>
  </div> -->

  <!-- Chatbot Modal -->
<div *ngIf="showChatbot" class="modal">
  <div class="modal-content">
    <div class="chat-header">
      <h3>Document Assistant: {{ selectedDocumentTitle || 'General Chat' }}</h3>
      <button (click)="closeChatbot()" class="close-btn" title="Close Chat"><i class="fa fa-times"></i> <!-- Close Icon --></button>
      <button (click)="clearChat()" class="clear-btn" title="Clear Chat"><i class="fa fa-eraser"></i> <!-- Clear Icon --></button>
    </div>

    <div class="chat-window">
      <div *ngFor="let message of chatMessages" class="message" [ngClass]="{
        'user-message': message.type === 'user',
        'system-message': message.type === 'system',
        'error-message': message.type === 'error',
        'success-message': message.type === 'success'
      }">
        <div class="message-content">{{ message.content }}</div>
        <div class="message-timestamp">{{ message.timestamp }}</div>
      </div>
    </div>

    <div class="predefined-questions">
      <button *ngFor="let question of predefinedQuestions" (click)="setPredefinedQuestion(question)">
        {{ question }}
      </button>
    </div>

    <div class="chat-input">
      <textarea
        [(ngModel)]="chatInput"
        (keypress)="onKeyPress($event)"
        placeholder="Ask a question..."
        class="text-input"
      ></textarea>
      <button (click)="handleChatInput()" class="send-btn">Send</button>
    </div>
  </div>
</div>

</div>